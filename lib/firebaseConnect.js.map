{"version":3,"file":"firebaseConnect.js","names":["firebaseConnect","queriesConfig","arguments","length","WrappedComponent","FirebaseConnectWithContext","props","_react","default","createElement","_ReactReduxFirebaseContext","Consumer","_internalFirebase","FirebaseConnectWrapped","_extends","dispatch","firebase","_Component","_this","_classCallCheck","_len","args","Array","_key","_super","call","apply","concat","_defineProperty","_assertThisInitialized","_inherits","_createSuper","_createClass","key","value","componentDidMount","_this$props","inputAsFunc","createCallable","prevData","ref","helpers","storage","database","auth","_objectSpread","_firebaseEvents","getEventsFromInput","watchEvents","componentWillUnmount","_this$props2","unWatchEvents","UNSAFE_componentWillReceiveProps","np","_this$props3","data","store","_isEqual2","itemsToSubscribe","_differenceWith2","itemsToUnsubscribe","render","Component","wrapDisplayName","propTypes","PropTypes","func","isRequired","object","displayName","wrappedComponent","hoistStatics","module","exports"],"sources":["../src/firebaseConnect.js"],"sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { isEqual, differenceWith } from 'lodash'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { watchEvents, unWatchEvents } from './actions/query'\nimport { getEventsFromInput, createCallable, wrapDisplayName } from './utils'\nimport ReactReduxFirebaseContext from './ReactReduxFirebaseContext'\n\n/**\n * @augments React.Component\n * @description React Higher Order Component that automatically listens/unListens to\n * Firebase Real Time Database on mount/unmount of the component. This uses\n * React's Component Lifecycle hooks.\n * @param {Array|Function} queriesConfig - Array of objects or strings for paths to sync\n * from Firebase. Can also be a function that returns the array. The function\n * is passed the current props and the firebase object.\n * @returns {Function} - that accepts a component to wrap and returns the wrapped component\n * @see https://react-redux-firebase.com/docs/api/firebaseConnect.html\n * @example <caption>Basic</caption>\n * // props.firebase set on App component as firebase object with helpers\n * import { firebaseConnect } from 'react-redux-firebase'\n * export default firebaseConnect()(App)\n * @example <caption>Ordered Data</caption>\n * import React from 'react'\n * import { compose } from 'redux'\n * import { connect } from 'react-redux'\n * import { firebaseConnect } from 'react-redux-firebase'\n *\n * const enhance = compose(\n *   firebaseConnect([\n *     'todos' // sync /todos from firebase into redux\n *   ]),\n *   connect((state) => ({\n *     todos: state.firebase.ordered.todos\n *   }))\n * )\n *\n * function Todos({ todos }) {\n *   return (\n *     <div>\n *       {JSON.stringify(todos, null, 2)}\n *     </div>\n *   )\n * }\n *\n * export default enhance(Todos)\n * @example <caption>Data that depends on props</caption>\n * import React from 'react'\n * import { compose } from 'redux'\n * import { connect } from 'react-redux'\n * import { get } from 'lodash'\n * import { firebaseConnect } from 'react-redux-firebase'\n *\n * const enhance = compose(\n *   firebaseConnect((props) => ([\n *     `posts/${props.postId}` // sync /posts/postId from firebase into redux\n *   ])),\n *   connect((state, props) => ({\n *     post: get(state.firebase.data, `posts.${props.postId}`),\n *   }))\n * )\n *\n * function Post({ post }) {\n *   return (\n *     <div>\n *      {JSON.stringify(post, null, 2)}\n *     </div>\n *   )\n * }\n *\n * export default enhance(Post)\n */\nexport default function firebaseConnect(queriesConfig = []) {\n  return (WrappedComponent) => {\n    class FirebaseConnectWrapped extends Component {\n      static displayName = wrapDisplayName(\n        WrappedComponent,\n        'FirebaseConnectWrapped'\n      )\n\n      static wrappedComponent = WrappedComponent\n\n      firebaseEvents = []\n      firebase = null\n      prevData = null\n\n      componentDidMount() {\n        const { firebase, dispatch } = this.props\n\n        // Allow function to be passed\n        const inputAsFunc = createCallable(queriesConfig)\n        this.prevData = inputAsFunc(this.props, this.props)\n\n        const { ref, helpers, storage, database, auth } = firebase\n        this.firebase = { ref, storage, database, auth, ...helpers }\n\n        this._firebaseEvents = getEventsFromInput(this.prevData)\n\n        watchEvents(firebase, dispatch, this._firebaseEvents)\n      }\n\n      componentWillUnmount() {\n        const { firebase, dispatch } = this.props\n        unWatchEvents(firebase, dispatch, this._firebaseEvents)\n      }\n\n      /* eslint-disable camelcase */\n      UNSAFE_componentWillReceiveProps(np) {\n        /* eslint-enable camelcase */\n        const { firebase, dispatch } = this.props\n        const inputAsFunc = createCallable(queriesConfig)\n        const data = inputAsFunc(np, this.store)\n\n        // Handle a data parameter having changed\n        if (!isEqual(data, this.prevData)) {\n          const itemsToSubscribe = differenceWith(data, this.prevData, isEqual)\n          const itemsToUnsubscribe = differenceWith(\n            this.prevData,\n            data,\n            isEqual\n          )\n\n          this.prevData = data\n          // UnWatch all current events\n          unWatchEvents(\n            firebase,\n            dispatch,\n            getEventsFromInput(itemsToUnsubscribe)\n          )\n          // Get watch events from new data\n          this._firebaseEvents = getEventsFromInput(data)\n\n          // Watch new events\n          watchEvents(firebase, dispatch, getEventsFromInput(itemsToSubscribe))\n        }\n      }\n\n      render() {\n        return <WrappedComponent {...this.props} />\n      }\n    }\n\n    FirebaseConnectWrapped.propTypes = {\n      dispatch: PropTypes.func.isRequired,\n      firebase: PropTypes.object.isRequired\n    }\n\n    /**\n     * Render component wrapped in context\n     * @param {object} props - Component props\n     * @returns {React.Component} Component wrapped in context\n     */\n    function FirebaseConnectWithContext(props) {\n      return (\n        <ReactReduxFirebaseContext.Consumer>\n          {(_internalFirebase) => (\n            <FirebaseConnectWrapped\n              {...props}\n              dispatch={_internalFirebase.dispatch}\n              firebase={_internalFirebase}\n            />\n          )}\n        </ReactReduxFirebaseContext.Consumer>\n      )\n    }\n\n    FirebaseConnectWithContext.displayName = wrapDisplayName(\n      WrappedComponent,\n      'FirebaseConnect'\n    )\n\n    FirebaseConnectWithContext.wrappedComponent = WrappedComponent\n\n    return hoistStatics(FirebaseConnectWithContext, WrappedComponent)\n  }\n}\n"],"mappings":"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","ignoreList":[]}