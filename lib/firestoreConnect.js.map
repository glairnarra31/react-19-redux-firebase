{"version":3,"file":"firestoreConnect.js","names":["firestoreConnect","queriesConfig","arguments","length","WrappedComponent","FirestoreConnectWithContext","props","_react","default","createElement","_ReactReduxFirebaseContext","Consumer","_internalFirebase","_ReduxFirestoreContext","_internalFirestore","FirestoreConnectWrapped","_extends","dispatch","firestore","firebase","_Component","_this","_classCallCheck","_len","args","Array","_key","_super","call","apply","concat","_defineProperty","_assertThisInitialized","_inherits","_createSuper","_createClass","key","get","value","componentDidMount","firestoreIsEnabled","inputAsFunc","createCallable","prevData","setListeners","componentWillUnmount","unsetListeners","UNSAFE_componentWillReceiveProps","np","data","_isEqual2","changes","getChanges","removed","added","render","Component","wrapDisplayName","propTypes","PropTypes","func","isRequired","object","displayName","wrappedComponent","hoistStatics","module","exports"],"sources":["../src/firestoreConnect.js"],"sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { isEqual } from 'lodash'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { createCallable, wrapDisplayName, getChanges } from './utils'\nimport ReduxFirestoreContext from './ReduxFirestoreContext'\nimport ReactReduxFirebaseContext from './ReactReduxFirebaseContext'\n\n/**\n * @augments React.Component\n * @description Higher Order Component that automatically listens/unListens\n * to provided Cloud Firestore paths using React's Lifecycle hooks. Make sure you\n * have required/imported Cloud Firestore, including it's reducer, before\n * attempting to use. **Note** Populate is not yet supported.\n * @param {Array|Function} queriesConfig - Array of objects or strings for paths to sync\n * from Firebase. Can also be a function that returns the array. The function\n * is passed the current props and the firebase object.\n * @returns {Function} - Function which accepts a component to wrap and returns the\n * wrapped component\n * @see https://react-redux-firebase.com/docs/api/firestoreConnect.html\n * @example <caption>Basic</caption>\n * // props.firebase set on App component as firebase object with helpers\n * import { firestoreConnect } from 'react-redux-firebase'\n * export default firestoreConnect()(SomeComponent)\n * @example <caption>Basic</caption>\n * import { connect } from 'react-redux'\n * import { firestoreConnect } from 'react-redux-firebase'\n *\n * // pass todos list from redux as props.todosList\n * export default compose(\n *   firestoreConnect(() => ['todos']), // sync todos collection from Firestore into redux\n *   connect((state) => ({\n *     todosList: state.firestore.data.todos\n *   })\n * )(SomeComponent)\n */\nexport default function firestoreConnect(queriesConfig = []) {\n  return (WrappedComponent) => {\n    class FirestoreConnectWrapped extends Component {\n      static wrappedComponent = WrappedComponent\n      static displayName = wrapDisplayName(\n        WrappedComponent,\n        'FirestoreConnectWrapped'\n      )\n\n      prevData = null\n\n      get firestoreIsEnabled() {\n        return !!this.props.firestore\n      }\n\n      componentDidMount() {\n        if (this.firestoreIsEnabled) {\n          // Listener configs as object (handling function being passed)\n          const inputAsFunc = createCallable(queriesConfig)\n          this.prevData = inputAsFunc(this.props, this.props)\n          // Attach listeners based on listener config\n          this.props.firestore.setListeners(this.prevData)\n        }\n      }\n\n      componentWillUnmount() {\n        if (this.firestoreIsEnabled && this.prevData) {\n          this.props.firestore.unsetListeners(this.prevData)\n        }\n      }\n\n      /* eslint-disable camelcase */\n      UNSAFE_componentWillReceiveProps(np) {\n        /* eslint-enable camelcase */\n        const { firestore } = this.props\n        const inputAsFunc = createCallable(queriesConfig)\n        const data = inputAsFunc(np, this.props)\n\n        // Check for changes in the listener configs\n        if (this.firestoreIsEnabled && !isEqual(data, this.prevData)) {\n          const changes = getChanges(data, this.prevData)\n\n          this.prevData = data\n\n          // Remove listeners for inactive subscriptions\n          firestore.unsetListeners(changes.removed)\n\n          // Add listeners for new subscriptions\n          firestore.setListeners(changes.added)\n        }\n      }\n\n      render() {\n        return <WrappedComponent {...this.props} />\n      }\n    }\n\n    FirestoreConnectWrapped.propTypes = {\n      dispatch: PropTypes.func.isRequired,\n      firebase: PropTypes.object,\n      firestore: PropTypes.object\n    }\n\n    /**\n     * Render component wrapped in context\n     * @param {object} props - Component props\n     * @returns {React.Component} Component wrapped in context\n     */\n    function FirestoreConnectWithContext(props) {\n      return (\n        <ReactReduxFirebaseContext.Consumer>\n          {(_internalFirebase) => (\n            <ReduxFirestoreContext.Consumer>\n              {(_internalFirestore) => (\n                <FirestoreConnectWrapped\n                  {...props}\n                  dispatch={_internalFirebase.dispatch}\n                  firestore={_internalFirestore}\n                  firebase={_internalFirebase}\n                />\n              )}\n            </ReduxFirestoreContext.Consumer>\n          )}\n        </ReactReduxFirebaseContext.Consumer>\n      )\n    }\n\n    FirestoreConnectWithContext.displayName = wrapDisplayName(\n      WrappedComponent,\n      'FirestoreConnect'\n    )\n\n    FirestoreConnectWithContext.wrappedComponent = WrappedComponent\n\n    return hoistStatics(FirestoreConnectWithContext, WrappedComponent)\n  }\n}\n"],"mappings":"m/HAoCe,QAAS,CAAAA,gBAAgBA,CAAA,CAAqB,IAApB,CAAAC,aAAa,GAAAC,SAAA,CAAAC,MAAA,EAAAD,SAAA,aAAAA,SAAA,IAAG,EAAE,CACzD,MAAO,UAACE,gBAAgB,CAAK,CAmE3B,QAAS,CAAAC,2BAA2BA,CAACC,KAAK,CAAE,CAC1C,MACE,CAAAC,MAAA,CAAAC,OAAA,CAAAC,aAAA,CAACC,0BAAA,CAAAF,OAAyB,CAACG,QAAQ,MAChC,SAACC,iBAAiB,QACjB,CAAAL,MAAA,CAAAC,OAAA,CAAAC,aAAA,CAACI,sBAAA,CAAAL,OAAqB,CAACG,QAAQ,MAC5B,SAACG,kBAAkB,QAClB,CAAAP,MAAA,CAAAC,OAAA,CAAAC,aAAA,CAACM,uBAAuB,CAAAC,QAAA,IAClBV,KAAK,EACTW,QAAQ,CAAEL,iBAAiB,CAACK,QAAS,CACrCC,SAAS,CAAEJ,kBAAmB,CAC9BK,QAAQ,CAAEP,iBAAkB,EAC7B,CAAC,CAE0B,CAAC,CAED,CAExC,CAAC,GAnFK,CAAAG,uBAAuB,UAAAK,UAAA,WAAAL,wBAAA,MAAAM,KAAA,CAAAC,eAAA,MAAAP,uBAAA,UAAAQ,IAAA,CAAArB,SAAA,CAAAC,MAAA,CAAAqB,IAAA,CAAAC,KAAA,CAAAF,IAAA,EAAAG,IAAA,GAAAA,IAAA,CAAAH,IAAA,CAAAG,IAAA,GAAAF,IAAA,CAAAE,IAAA,EAAAxB,SAAA,CAAAwB,IAAA,SAAAL,KAAA,CAAAM,MAAA,CAAAC,IAAA,CAAAC,KAAA,CAAAF,MAAA,QAAAG,MAAA,CAAAN,IAAA,GAAAO,eAAA,CAAAC,sBAAA,CAAAX,KAAA,aAOhB,IAAI,EAAAA,KAAA,CAAAY,SAAA,CAAAlB,uBAAA,CAAAK,UAAA,MAAAO,MAAA,CAAAO,YAAA,CAAAnB,uBAAA,SAAAoB,YAAA,CAAApB,uBAAA,GAAAqB,GAAA,sBAAAC,GAAA,CAEf,SAAAA,IAAA,CAAyB,CACvB,MAAO,CAAC,CAAC,IAAI,CAAC/B,KAAK,CAACY,SACtB,CAAC,GAAAkB,GAAA,qBAAAE,KAAA,CAED,SAAAC,kBAAA,CAAoB,CAClB,GAAI,IAAI,CAACC,kBAAkB,CAAE,CAE3B,GAAM,CAAAC,WAAW,CAAG,GAAAC,qBAAc,EAACzC,aAAa,CAAC,CACjD,IAAI,CAAC0C,QAAQ,CAAGF,WAAW,CAAC,IAAI,CAACnC,KAAK,CAAE,IAAI,CAACA,KAAK,CAAC,CAEnD,IAAI,CAACA,KAAK,CAACY,SAAS,CAAC0B,YAAY,CAAC,IAAI,CAACD,QAAQ,CACjD,CACF,CAAC,GAAAP,GAAA,wBAAAE,KAAA,CAED,SAAAO,qBAAA,CAAuB,CACjB,IAAI,CAACL,kBAAkB,EAAI,IAAI,CAACG,QAAQ,EAC1C,IAAI,CAACrC,KAAK,CAACY,SAAS,CAAC4B,cAAc,CAAC,IAAI,CAACH,QAAQ,CAErD,CAAC,GAAAP,GAAA,oCAAAE,KAAA,CAGD,SAAAS,iCAAiCC,EAAE,CAAE,IAE3B,CAAA9B,SAAS,CAAK,IAAI,CAACZ,KAAK,CAAxBY,SAAS,CACXuB,WAAW,CAAG,GAAAC,qBAAc,EAACzC,aAAa,CAAC,CAC3CgD,IAAI,CAAGR,WAAW,CAACO,EAAE,CAAE,IAAI,CAAC1C,KAAK,CAAC,CAGxC,GAAI,IAAI,CAACkC,kBAAkB,EAAI,CAAC,GAAAU,SAAA,CAAA1C,OAAA,EAAQyC,IAAI,CAAE,IAAI,CAACN,QAAQ,CAAC,CAAE,CAC5D,GAAM,CAAAQ,OAAO,CAAG,GAAAC,iBAAU,EAACH,IAAI,CAAE,IAAI,CAACN,QAAQ,CAAC,CAE/C,IAAI,CAACA,QAAQ,CAAGM,IAAI,CAGpB/B,SAAS,CAAC4B,cAAc,CAACK,OAAO,CAACE,OAAO,CAAC,CAGzCnC,SAAS,CAAC0B,YAAY,CAACO,OAAO,CAACG,KAAK,CACtC,CACF,CAAC,GAAAlB,GAAA,UAAAE,KAAA,CAED,SAAAiB,OAAA,CAAS,CACP,MAAO,CAAAhD,MAAA,CAAAC,OAAA,CAAAC,aAAA,CAACL,gBAAgB,CAAK,IAAI,CAACE,KAAQ,CAC5C,CAAC,IAAAS,uBAAA,EApDmCyC,gBAAS,EA4F/C,OAAAzB,eAAA,CA5FMhB,uBAAuB,oBACDX,gBAAgB,EAAA2B,eAAA,CADtChB,uBAAuB,eAEN,GAAA0C,sBAAe,EAClCrD,gBAAgB,CAChB,yBACF,CAAC,EAkDHW,uBAAuB,CAAC2C,SAAS,CAAG,CAClCzC,QAAQ,CAAE0C,kBAAS,CAACC,IAAI,CAACC,UAAU,CACnC1C,QAAQ,CAAEwC,kBAAS,CAACG,MAAM,CAC1B5C,SAAS,CAAEyC,kBAAS,CAACG,MACvB,CAAC,CA0BDzD,2BAA2B,CAAC0D,WAAW,CAAG,GAAAN,sBAAe,EACvDrD,gBAAgB,CAChB,kBACF,CAAC,CAEDC,2BAA2B,CAAC2D,gBAAgB,CAAG5D,gBAAgB,CAExD,GAAA6D,6BAAY,EAAC5D,2BAA2B,CAAED,gBAAgB,CACnE,CACF,CAAC8D,MAAA,CAAAC,OAAA,CAAAA,OAAA,CAAA3D,OAAA","ignoreList":[]}